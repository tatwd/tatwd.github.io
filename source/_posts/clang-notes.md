---
title: C 语言拾遗
date: 2019-05-24 00:06:21
tags:
---

C 是我学的第一门程序语言，也是让我认识和接触计算机、软件开发的开始。至今想来，我的思维有时侯其实存在的最多的还是面向过程的。

C 的标准：C89，C90，C99，C11。其中，C89、C90 标准相同，又称 ASCI C；C99 应用最广,我当时学的就算这个标准。

在这里，我想将后来学习的 C++、C#、Java、JavaScript 统称为“C 系语言”。虽然它们与 C 是如此的不同。

## 空指针和函数指针

空指针（`void *`）和函数指针的存在是我以前常常忽视的两种特殊的指针。实际上，它们在 C 语言的开发中扮演着极为重要的角色，也与上述提及那些语言存在着极为密切的关系。

### 1、空指针

空指针不代表任何类型，却可以成为任何类型。对它的赋值和转化必须按照相同的类型进行，以保证数据前后的一致性。

```c
int foo = 1;
void *bar = foo;
int baz = (int)bar; /* 1 */
```
也就是说，不一致的转换将在大多数情况下照成数据的缺失。

```c
int foo = 65540;
void *bar = foo;
short baz = (short)bar; /* 4 */
```
这是因为在 C 语言中，类型转换是根据类型的大小重新对内存进行规划的（如图 1）。毫无疑问，在其它的语言当中亦是如此。空指针的大小根据操作系统的位数来决定（包括其它类型的指针），一般是 32 bit 系统是 4 Byte，64bit系统是 8 Byte。

{% asset_img 1.png 图 1 %}

空指针必须进行类型转换后才能访问。这有点像面向对象语言中的 `Object` 类型的实例，只有在经过类型转换（如拆箱）后它才会有实际意义。

另一方面，空指针的存在也让 C 具有了一定的**泛型**或**模板化**编程的可能性。比如，可以利用它写出一个能交换两个任意类型变量值的程序出来。

```c
#include <string.h> /* memcpy */

/* size 是对应指针类型的大小(单位: Byte) */
void swap(void *ap, void *bp, int size)
{
    char buffer[size];
    memcpy(buffer, ap, size);
    memcpy(ap, bp, size);
    memcpy(bp, buffer, size);
}
```

这个 `swap` 将可以进行不同类型的变量交换，如：

```c
int a = 1, b = 2;
swap(&a, &b, sizeof(int));

char *a = "foo", *b = "bar";
swap(&a, &b, sizeof(char *));
```

也即是说，利用空指针可以写出适应不同类型的通用模型或数据结构出来。

### 2、函数指针

函数指针可以将某个程序的操作延迟到调研用，让程序适应不同的调用场景。这与面向对象语言的**多态**特点类似。这其实也是面向对象语言三大特性中较 C 而言最大的优点。

函数指针扮演的实际上是回调函数的角色。JavaScript 充分发挥了这一特性。



## 栈和堆

TODO

## 进程和线程

TODO

## 套接字

TODO