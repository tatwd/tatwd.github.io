<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="ie=edge"><!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> --><meta name="generator" content="Hexo 5.3.0"><meta name="description" content="打算写这个游戏的想法不是“蓄谋已久”的，它不过是为了完成作业而作出来的产物。虽然到目前为止，它还有许多的不足，但至少没有“胎死腹中”。（有兴趣的朋友可以下来玩玩：点我下载）   这种棋，是我小时候经常玩的，玩法大多是就地取材：在地上画个棋盘，以石头或树叶或树枝什么的为棋子，各6个。规则很简单：石头剪刀布决定谁现在走，每人轮流走一步，将对方棋子围死即可拿走，一方棋子数小于3个即输。像这类的棋，我小时"><meta property="og:type" content="article"><meta property="og:title" content="谈谈我写的第一个游戏：西瓜棋"><meta property="og:url" content="https://jin.cloong.me/2017/06/17/talk-wchess/index.html"><meta property="og:site_name" content="_King&#39;s Notes"><meta property="og:description" content="打算写这个游戏的想法不是“蓄谋已久”的，它不过是为了完成作业而作出来的产物。虽然到目前为止，它还有许多的不足，但至少没有“胎死腹中”。（有兴趣的朋友可以下来玩玩：点我下载）   这种棋，是我小时候经常玩的，玩法大多是就地取材：在地上画个棋盘，以石头或树叶或树枝什么的为棋子，各6个。规则很简单：石头剪刀布决定谁现在走，每人轮流走一步，将对方棋子围死即可拿走，一方棋子数小于3个即输。像这类的棋，我小时"><meta property="og:locale"><meta property="og:image" content="https://jin.cloong.me/2017/06/17/talk-wchess/talk-wchess-0.png"><meta property="og:image" content="https://jin.cloong.me/2017/06/17/talk-wchess/talk-wchess-1.png"><meta property="og:image" content="https://jin.cloong.me/2017/06/17/talk-wchess/talk-wchess-2.png"><meta property="article:published_time" content="2017-06-17T14:40:59.000Z"><meta property="article:modified_time" content="2021-03-03T13:32:47.116Z"><meta property="article:author" content="_king"><meta property="article:tag" content="C++"><meta property="article:tag" content="watermelon-chess"><meta property="article:tag" content="Qt"><meta property="article:tag" content="Game"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://jin.cloong.me/2017/06/17/talk-wchess/talk-wchess-0.png"><link rel="icon" href=""><title>_King&#39;s Notes</title><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Open+Sans|Roboto+Mono" rel="stylesheet"> --><!-- <link href="https://fonts.lug.ustc.edu.cn/css?family=Montserrat|Open+Sans|Roboto+Mono" rel="stylesheet"> --><link rel="stylesheet" href="/fonts/index.css"><link rel="stylesheet" href="/css/common.css"><style>.avatar::before{display:block;content:'';background:url(/img/avatar.jpg) no-repeat center;background-size:cover;border-radius:50%;border:1px solid #e6e6e6;height:62px;width:62px;margin:0 auto;margin-top:32px}</style><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" href="/css/prism.css"><link rel="stylesheet" href="/css/comment.css"><script>!function(){document.addEventListener("DOMContentLoaded",function(e){var o=window.decodeURI(location.hash.replace("#",""));if(""!==o){var t=document.getElementById(o);if(console.log(t),t){var n=t.offsetTop;setTimeout(function(){window.scrollTo(0,n-0)},0)}}});var e=(new Date).getHours();(e<6||18<=e)&&document.querySelector("html").setAttribute("theme","dark"),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){console.log(e)})}()</script><link rel="alternate" href="/atom.xml" title="_King's Notes" type="application/atom+xml"></head><body><div class="container"><div id="post"><div id="index__header"><div class="avatar text-center"></div><h2 class="h2 text-center text-upper"><a class="color--black" href="/">_King&#39;s Notes</a></h2><div class="text-center"><!-- github icon --> <a class="goto" href="https://github.com/tatwd" target="_blank"><svg class="icon" width="16" height="16" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg> </a><a class="goto" href="mailto:tatwdo@gmail.com"><svg class="icon" width="16" height="16" viewBox="0 0 1024 1024" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M512 0a512 512 0 0 0 0 1024 42.666667 42.666667 0 0 0 0-85.333333 426.666667 426.666667 0 1 1 426.666667-426.666667v85.333333a85.333333 85.333333 0 1 1-169.386667 0V298.666667a42.666667 42.666667 0 0 0-85.333333 0v22.4a257.28 257.28 0 1 0 21.333333 359.253333A170.666667 170.666667 0 0 0 1024 597.333333v-85.333333A512 512 0 0 0 512 0z m0 683.946667A171.946667 171.946667 0 1 1 683.946667 512 172.16 172.16 0 0 1 512 683.946667z"></path></svg> </a><a class="goto" href="https://jin.cloong.me/atom.xml" target="_blank"><svg class="icon" width="16" height="16" viewBox="0 0 1024 1024" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M320.374394 768q0 45.714286-32 77.714286t-77.714285 32-77.714286-32-32-77.714286 32-77.714286 77.714286-32 77.714285 32 32 77.714286z m292.571429 70.285714q1.142857 16-9.714286 27.428572-10.285714 12-26.857143 12H499.231537q-14.285714 0-24.571428-9.428572t-11.428572-23.714285q-12.571429-130.857143-105.428571-223.714286T134.08868 515.428571q-14.285714-1.142857-23.714286-11.428571T100.945823 479.428571V402.285714q0-16.571429 12-26.857143 9.714286-9.714286 24.571428-9.714285h2.857143q91.428571 7.428571 174.857143 46T463.231537 515.428571q65.142857 64.571429 103.714286 148t46 174.857143z m292.571428 1.142857q1.142857 15.428571-10.285714 26.857143-10.285714 11.428571-26.285714 11.428572h-81.714286q-14.857143 0-25.428571-10T750.660109 843.428571q-6.857143-122.857143-57.714286-233.428571t-132.285714-192-192-132.285714T135.231537 227.428571q-14.285714-0.571429-24.285714-11.142857T100.945823 191.428571V109.714286q0-16 11.428571-26.285715 10.285714-10.285714 25.142857-10.285714h1.714286q149.714286 7.428571 286.571429 68.571429T668.945823 309.714286q106.857143 106.285714 168 243.142857t68.571428 286.571428z"></path></svg></a></div></div><div id="post__mainer"><div class="sm-container"><div class="post--body"><div class="post__title"><span>2017-06-17 10:40:59</span><h1 class="h1 text-upper">谈谈我写的第一个游戏：西瓜棋</h1></div><div class="post__content"><p>打算写这个游戏的想法不是“蓄谋已久”的，它不过是为了完成作业而作出来的产物。虽然到目前为止，它还有许多的不足，但至少没有“胎死腹中”。（有兴趣的朋友可以下来玩玩：<a target="_blank" rel="noopener" href="https://github.com/tatwd/watermelon-chess/raw/master/wiki-resources/downloads/watermelon-chess-1.6.1-install.exe">点我下载</a>）</p><img src="/2017/06/17/talk-wchess/talk-wchess-0.png" class="" title="talk-wchess-0"><p>这种棋，是我小时候经常玩的，玩法大多是就地取材：在地上画个棋盘，以石头或树叶或树枝什么的为棋子，各6个。规则很简单：石头剪刀布决定谁现在走，每人轮流走一步，将对方棋子围死即可拿走，一方棋子数小于3个即输。像这类的棋，我小时候还玩过许多。</p><p>刚开始，我设想这游戏有两种模式：单机模式、联机模式。如果要实现话，得完成以下几步：<code>1)棋盘及棋子的绘制；2)实现人走棋；3)实现吃棋；4)实现悔棋、认输、和棋等 功能；5)实现电脑走棋。</code>本来还想实现联机模式的，后来发现还是留到以后再说吧。</p><h2 id="界面绘制"><a href="#界面绘制" class="headerlink" title="界面绘制"></a>界面绘制</h2><a id="more"></a><p>我首先遇到的第一个问题是怎样方便快捷地实现图形界面的绘制，即棋盘棋子的绘制。在此之前，我没有一点的窗体编程的经验，也不清楚用那种语言来开发更合理，没办法我只能找度娘、看大神的经验之谈了。最终，我选择了<code>C++</code>和<code>Qt</code>。在选工具时，本来想选Visual Studio 2013的，后来发现它的内库不太方便（好吧，其实是我看不太懂），所以就放弃了，选了Qt。</p><p>Qt的绘图相对较简单。创建一个Qt Widgets Application应用，在实现类（如：Board类）中的绘图事件paintEvent中，用QPainter创建一个画笔对象，然后用这个对象去调用它的成员函数来绘制图形即可。如：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Board.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter></span></span>

<span class="token keyword">void</span> <span class="token class-name">Board</span><span class="token operator">::</span><span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  QPainter <span class="token function">painter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                             <span class="token comment">//创建画笔对象</span>
  painter<span class="token punctuation">.</span><span class="token function">drawEllipse</span><span class="token punctuation">(</span><span class="token function">QPoint</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//画圆，传入圆心坐标、长轴、短轴</span>
  painter<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token function">QPoint</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">QPoint</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//画线，传入直线的起点、终点坐标</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="选坐标系"><a href="#选坐标系" class="headerlink" title="选坐标系"></a>选坐标系</h2><p>然而，在绘制棋子时，我又遇到了一个严重的问题：坐标系的选择。刚开始，我用的是直角坐标系，发现能够把所有棋子都绘制出来，但棋子的遍历（包括棋盘上所点的遍历）却成了一个极大的问题。如果不解决话，后面的走棋、吃棋等都无法实现或者说很难实现。这个问题一度让我写不下去了（停了一个多礼拜）。后来突然有一天，脑子一抽，发现我的棋盘是一个关于中心对称的圆形啊，为什么不能用极坐标系呢？以棋盘中心为原点，只需要一个<code>极径</code>和一个<code>极角</code>就能确定棋盘上所有的点。</p><img src="/2017/06/17/talk-wchess/talk-wchess-1.png" class="" title="talk-wchess-1"><p>于是乎，遍历问题便不难了:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">/*获取棋盘上点的极坐标*/</span>
<span class="token keyword">void</span> <span class="token class-name">Board</span><span class="token operator">::</span><span class="token function">getAROfBoard</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>angle<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>r<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  angle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token operator">>=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> pos<span class="token operator">&lt;=</span><span class="token number">11</span><span class="token punctuation">)</span>       <span class="token comment">//第0~11个点，即第1圈</span>
  <span class="token punctuation">&#123;</span>
    angle <span class="token operator">=</span> pos<span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">;</span>
    r <span class="token operator">=</span> _R<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token operator">>=</span><span class="token number">12</span> <span class="token operator">&amp;&amp;</span> pos<span class="token operator">&lt;=</span><span class="token number">19</span><span class="token punctuation">)</span> <span class="token comment">//第12~19个点，即第2、3圈</span>
  <span class="token punctuation">&#123;</span>
    angle <span class="token operator">=</span> <span class="token punctuation">(</span>pos<span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">90</span><span class="token punctuation">;</span>
    r <span class="token operator">=</span> _R<span class="token operator">*</span><span class="token number">13</span><span class="token operator">/</span><span class="token number">18</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token operator">></span><span class="token number">15</span><span class="token punctuation">)</span>
      r <span class="token operator">=</span> _R<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">//中心点（即第4圈）为(0, 0)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*遍历棋盘所有的点并返回该点pos的像素坐标*/</span>
QPoint <span class="token class-name">Board</span><span class="token operator">::</span><span class="token function">getPointOfBoard</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>angle<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>r<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  QPoint <span class="token function">bCenter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//棋盘中心坐标</span>
  <span class="token function">getAROfBoard</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取该点的极坐标</span>
  <span class="token keyword">return</span> <span class="token function">polarCoordToXY</span><span class="token punctuation">(</span>bCenter<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将极坐标转成像素坐标</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="死子判断"><a href="#死子判断" class="headerlink" title="死子判断"></a>死子判断</h2><p>在解决了这个问题之后，我又迎来了第3个大问题：死子判断。虽然利用下面的算法完成了对单个棋子的死活判断，但没有实现对多个棋子的判断（目前还未去解决，待解决）。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">/*获取棋子被围数*/</span>
<span class="token keyword">int</span> <span class="token class-name">Board</span><span class="token operator">::</span><span class="token function">getSurroundStone</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  QPoint sCenter <span class="token operator">=</span> <span class="token function">polarCoordToXY</span><span class="token punctuation">(</span><span class="token function">QPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取该子的像素坐标</span>
  <span class="token keyword">int</span> d <span class="token operator">=</span> _R<span class="token operator">*</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">18</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>_s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>_dead<span class="token punctuation">)</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>

    QPoint iCenter <span class="token operator">=</span> <span class="token function">polarCoordToXY</span><span class="token punctuation">(</span><span class="token function">QPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> dx <span class="token operator">=</span> sCenter<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> iCenter<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> dy <span class="token operator">=</span> sCenter<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> iCenter<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//被对手棋子全包围时</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dx<span class="token operator">*</span>dx <span class="token operator">+</span> dy<span class="token operator">*</span>dy<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>dx<span class="token operator">*</span>dx <span class="token operator">+</span> dy<span class="token operator">*</span>dy<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> d<span class="token operator">*</span>d <span class="token operator">&amp;&amp;</span> _s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>_black <span class="token operator">!=</span> _s<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>_black<span class="token punctuation">)</span> 
      n<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也就是说，当单个棋子被对手棋子全包围时，它会判断为死子，然后“消失”；但是，2个或2个以上的情况不会。</p><img src="/2017/06/17/talk-wchess/talk-wchess-2.png" class="" title="talk-wchess-2"><h2 id="电脑走棋"><a href="#电脑走棋" class="headerlink" title="电脑走棋"></a>电脑走棋</h2><p>电脑走棋方面，我使用的较为简单，大概相当于三岁小孩的水平，更深层次的还没有研究过。本来打算使用最近比较火的机器学习（Machine Learning, ML），我研究一段时间后，还是老老实实地用简单的吧。具体实现：先获取所有可能走法存入一个数组，然后对其中的每一步进行假想走棋并评估该走法的价值，最终得到一个最佳走法，从而使电脑来走。其中，价值评估算法（最小最大值算法）较为简陋，简单讲，就是被对手围的越少的走法，价值越高。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*电脑走棋*/</span>
<span class="token keyword">void</span> <span class="token class-name">SingleGame</span><span class="token operator">::</span><span class="token function">computerMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  Step<span class="token operator">*</span> step <span class="token operator">=</span> <span class="token function">getBestStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取最佳走法</span>
  <span class="token function">moveStone</span><span class="token punctuation">(</span>step<span class="token operator">-></span>_movedId<span class="token punctuation">,</span> step<span class="token operator">-></span>_killId<span class="token punctuation">,</span> step<span class="token operator">-></span>_angleTo<span class="token punctuation">,</span> step<span class="token operator">-></span>_rTo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//走棋</span>
  <span class="token class-name">Board</span><span class="token operator">::</span><span class="token function">movePromptInStatusBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//落子提示</span>
  <span class="token keyword">delete</span> step<span class="token punctuation">;</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*获取最佳走法*/</span>
Step<span class="token operator">*</span> <span class="token class-name">SingleGame</span><span class="token operator">::</span><span class="token function">getBestStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  QVector<span class="token operator">&lt;</span>Step <span class="token operator">*</span><span class="token operator">></span> steps<span class="token punctuation">;</span>
  <span class="token function">getAllPossibleMove</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span> maxScore <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100000</span><span class="token punctuation">;</span>
  Step<span class="token operator">*</span> ret <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>steps<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    Step<span class="token operator">*</span> step <span class="token operator">=</span> steps<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    steps<span class="token punctuation">.</span><span class="token function">removeLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">fakeMove</span><span class="token punctuation">(</span>step<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//假想走棋</span>
    <span class="token keyword">int</span> score <span class="token operator">=</span> <span class="token function">getMinScore</span><span class="token punctuation">(</span>_level <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> maxScore<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最小分</span>
    <span class="token function">unfakeMove</span><span class="token punctuation">(</span>step<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//恢复</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>score <span class="token operator">></span> maxScore<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      maxScore <span class="token operator">=</span> score<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
        <span class="token keyword">delete</span> ret<span class="token punctuation">;</span>
      ret <span class="token operator">=</span> step<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">delete</span> step<span class="token punctuation">;</span> <span class="token comment">//防止内存泄漏</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>总而言之，从预期来说，大部分功能已经实现，目前还未解决的问题还有两个：1)死子判断算法的完善；2)价值评估算法的优化。以后有可能的话，希望能实现联机模式，但到底可不可能，谁知道呢？</p><blockquote><p>项目源代码： <a target="_blank" rel="noopener" href="https://github.com/tatwd/watermelon-chess/tree/master/source">https://github.com/tatwd/watermelon-chess/tree/master/source</a></p></blockquote></div><script>document.querySelector(".post__content").addEventListener("click",function(e){var t=e.target,n=t.id;"H2"===t.nodeName&&n&&(location.hash="#"+n)})</script></div><hr style="border:1px dashed #eee"><div class="post--comment"></div><script type="x/template" id="comment-tmpl"><form>
      <p class="tip">加 * 为必填项，其中您输入的邮箱将不会公开！</p>
      <p>
        <label class="inline-block mb1">评论*</label>
        <textarea name="html_text" rows="4" class="block w100"></textarea>
      </p>
      <div class="clearfix">
        <p class="float--left w50 border-box" style="padding-right:5px;">
          <label class="inline-block mb1">昵称*</label>
          <input type="text" name="owner_name" class="block w100">
        </p>
        <p class="float--left w50 border-box" style="padding-left:5px;">
          <label class="inline-block mb1">邮箱*</label>
          <input type="email" name="owner_email" class="block w100">
        </p>
      </div>
      <p>
        <label class="inline-block mb1">网址</label>
        <input type="text" name="owner_website" class="block w100">
      </p>
      <p class="text-right"><button id="submitCommentBtn">发表评论</button></p>
    </form>
    <div class="comments">
      <!-- render comments here -->
    </div></script><script src="/js/talking.dev.js"></script><script>window.hexoThemeConfig={comment_sys_api:"https://www.sondge.club/tatwd/api/comments"}</script><script src="/js/post.js"></script></div></div></div></div></body></html>